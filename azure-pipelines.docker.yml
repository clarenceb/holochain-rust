# Azure Pipeline for holochain-rust
#
# Containerised build version
#
# See:
# - https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema#container
# - https://docs.microsoft.com/en-us/azure/devops/pipelines/process/container-phases

resources:
  containers:
    - container: builder
      image: ubuntu:14.04 # This version includes `sudo` which we need to install additional OS packages

# Due to an open bug you need to specify a VM pool name to run containers (expected to be fixed in Seop 2018)
pool:
  vmImage: 'Ubuntu 16.04'

# Run following steps in the specified container
container: builder

variables:
  cargo_home: /root/.cargo
  path: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

steps:
- script: |
    sudo apt-get update
    sudo apt-get install -y qt4-qmake
  displayName: 'Install build prerequisites'

- script: |
    make test_c_ci
  env:
    PATH: $(cargo_home)/bin:$(path)
  displayName: 'C binding tests'
